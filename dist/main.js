(()=>{var e={416:(e,t,n)=>{var a=n(495),i=n(490),l=n(892);t=a(!1);var o=i(l);t.push([e.id,".tu-config-container{padding:20px;display:flex}.tu-config-container .tu-col{padding-right:30px;padding-left:30px}.tu-config-container .tu-col:first-of-type{border-right:1px solid rgba(128,128,128,.1411764706)}.tu-config-container .tu-c:last-of-type{border-top:1px solid rgba(128,128,128,.1411764706)}.tu-config-container h3{display:inline-block;padding:5px 9px;color:#fff;border-radius:10px}.tu-config-container h3.energy{background-color:#f58181}.tu-config-container h3.water{background-color:#00a8ff}.tu-config-container h3.tax{color:#424242}.tu-config-container h3.invoice{color:#424242}.tu-config-container .tu-icon{display:inline-block;width:15px;height:15px;background-repeat:no-repeat;background-position:center;background-size:contain;vertical-align:center;transform:translateY(3px);margin-right:5px;filter:invert(1)}.tu-config-container .tu-icon.energy{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMC44NDgiIGhlaWdodD0iMzAuODQ5IiB2aWV3Qm94PSIwIDAgMzAuODQ4IDMwLjg0OSI+CiAgPHBhdGggaWQ9Ikljb25fbWV0cm8tcG93ZXIiIGRhdGEtbmFtZT0iSWNvbiBtZXRyby1wb3dlciIgZD0iTTE0LjEzOSwxLjkyOCwyLjU3MSwxNy4zNTJIMTQuMTM5TDYuNDI3LDMyLjc3NywzMy40MTksMTMuNUgxNy45OTVMMjkuNTYzLDEuOTI4WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIuNTcxIC0xLjkyOCkiLz4KPC9zdmc+Cg==)}.tu-config-container .tu-icon.water{background-image:url("+o+")}.tu-config-container .tu-icon.tax{display:none}.tu-config-container .tu-icon.invoice{display:none}.tu-config-container .tu-energy,.tu-config-container .tu-water,.tu-config-container .tu-tax,.tu-config-container .tu-invoice{display:flex;align-items:center;margin-bottom:40px}.tu-config-container .tu-energy .tu-unit,.tu-config-container .tu-water .tu-unit,.tu-config-container .tu-tax .tu-unit,.tu-config-container .tu-invoice .tu-unit{margin:0px 10px;opacity:.7;font-size:1.2em}.tu-config-container .tu-energy label,.tu-config-container .tu-water label,.tu-config-container .tu-tax label,.tu-config-container .tu-invoice label{width:100px;margin:0px}.tu-config-container .tu-energy input,.tu-config-container .tu-water input,.tu-config-container .tu-tax input,.tu-config-container .tu-invoice input{width:100px}.tu-config-container .tu-tax label{width:50px}.tu-config-container .tu-invoice{flex-direction:column;align-items:flex-start}.tu-config-container a.tu-upload{text-decoration:underline;display:block;cursor:pointer}.tu-config-container .tu-invoice-content{font-weight:bold;margin-top:15px;display:flex;align-items:center}.tu-action{padding:10px;display:flex;justify-content:center;align-items:center}",""]),e.exports=t},133:(e,t,n)=>{(t=n(495)(!1)).push([e.id,".tu-invoice-details h1{margin-left:10px}.tu-invoice-details .tu-header{display:flex;align-items:center;justify-content:space-between}.tu-invoice-details .tu-id-items{display:inline-block;background-color:#fafafa;border-radius:10px;overflow:hidden}.tu-invoice-details .tu-id-items .tu-id-item{border-bottom:1px solid rgba(221,221,221,.4);display:flex;margin:10px;align-items:center;padding:10px}.tu-invoice-details .tu-id-items .tu-id-item .desc{width:200px}.tu-invoice-details .tu-id-items .tu-id-item .consumption{width:200px}.tu-invoice-details .tu-id-items .tu-id-item .cost{width:200px}.tu-invoice-details .tu-id-items .tu-id-item>div{flex-grow:0;flex-shrink:0}.tu-invoice-details .tu-id-items .tu-id-item .cost{text-align:right}.tu-invoice-details .tu-id-items .tu-id-item.total .cost{font-weight:bold;font-size:1.2em}.tu-invoice-details .tu-dates{display:flex;margin-bottom:10px;margin-left:10px}.tu-invoice-details .tu-dates .tu-date{display:flex;margin:0px 10px;background:#eee;align-items:center;overflow:hidden;border-radius:8px}.tu-invoice-details .tu-dates .tu-date span{text-transform:uppercase;padding:5px 10px;background-color:#ddd}.tu-invoice-details .tu-dates .tu-date div{padding:5px 10px}.tu-invoice-details .editable{position:relative}.tu-invoice-details .editable input.uxp-form-input{width:120px;padding-right:25px;text-align:right}.tu-invoice-details .editable span.discout-unit{position:absolute;right:10px;top:50%;transform:translateY(-50%)}.tu-invoice-details .actions{display:flex;justify-content:flex-end}.tu-invoice-details .actions .uxp-button{margin:auto}.invoice-status{padding:5px 10px;border-radius:7px;color:#fff;background-color:#aaa;display:inline-block;text-transform:uppercase;font-size:11px}.invoice-status.invoiced{background-color:#ea8888}.invoice-status.paid{background-color:#4bab2e}.invoice-actions .uxp-button{margin-left:10px;font-size:10px}.invoice-actions .download-invoice{background:#06f;color:#fff}",""]),e.exports=t},99:(e,t,n)=>{var a=n(495),i=n(490),l=n(892);t=a(!1);var o=i(l);t.push([e.id,".tenants{position:relative;height:85%;width:100%;padding:0px 0px 0 0px}.tenants .data-list{border:1px solid #e3e3e3}.tenants .data-list .data-table thead tr th{padding-left:15px;text-align:left;background:#e3e3e3}.tenants .data-list .data-list-item{height:50px}.tenants .data-list .data-list-item.active{background-color:#fafafa !important}.tenants .data-list-footer{position:unset}.tenants .data-table-item{margin-left:7.5px}.add-meter{display:flex}.add-meter .tenant-name{display:flex;margin-bottom:15px}.add-meter .tenant-name .label{width:60px;font-weight:700}.add-meter .row{display:flex;justify-content:space-between;width:100%}.add-meter .row .col{width:48%}.add-meter .row .col .uxp-form-label{font-weight:500}.add-meter .delete-meter{margin-top:45px}.add-meter .error{color:red;margin:15px 0;padding:5px}.add-meter .actions{margin:15px 0}.add-meter .actions .uxp-button{margin:0;float:right}.tu-meters{display:flex;font-size:10px;color:#fff;flex-wrap:wrap}.tu-meters.energy .tu-meter-id{background-color:#f58181}.tu-meters.energy .tu-logo{filter:invert(1);background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMC44NDgiIGhlaWdodD0iMzAuODQ5IiB2aWV3Qm94PSIwIDAgMzAuODQ4IDMwLjg0OSI+CiAgPHBhdGggaWQ9Ikljb25fbWV0cm8tcG93ZXIiIGRhdGEtbmFtZT0iSWNvbiBtZXRyby1wb3dlciIgZD0iTTE0LjEzOSwxLjkyOCwyLjU3MSwxNy4zNTJIMTQuMTM5TDYuNDI3LDMyLjc3NywzMy40MTksMTMuNUgxNy45OTVMMjkuNTYzLDEuOTI4WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIuNTcxIC0xLjkyOCkiLz4KPC9zdmc+Cg==)}.tu-meters.water .tu-meter-id{background-color:#00a8ff}.tu-meters.water .tu-logo{background-image:url("+o+")}.tu-meters .tu-meter-id{padding:5px 8px;display:flex;border-radius:8px;align-items:center;color:#fff;margin:2px}.tu-meters .tu-meter-id .tu-logo{background-size:contain;background-position:center;background-repeat:no-repeat;width:20px;height:20px}.tu-meters .tu-meter-id .tu-txt{margin-left:5px}.utility-pill{padding:5px 8px;display:inline-flex;border-radius:8px;align-items:center;color:#fff;margin:2px}.utility-pill .up-logo{background-size:contain;background-position:center;background-repeat:no-repeat;width:20px;height:20px}.utility-pill .up-txt{margin-left:5px}.utility-pill.energy{background-color:#f58181}.utility-pill.energy .up-logo{filter:invert(1);background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMC44NDgiIGhlaWdodD0iMzAuODQ5IiB2aWV3Qm94PSIwIDAgMzAuODQ4IDMwLjg0OSI+CiAgPHBhdGggaWQ9Ikljb25fbWV0cm8tcG93ZXIiIGRhdGEtbmFtZT0iSWNvbiBtZXRyby1wb3dlciIgZD0iTTE0LjEzOSwxLjkyOCwyLjU3MSwxNy4zNTJIMTQuMTM5TDYuNDI3LDMyLjc3NywzMy40MTksMTMuNUgxNy45OTVMMjkuNTYzLDEuOTI4WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIuNTcxIC0xLjkyOCkiLz4KPC9zdmc+Cg==)}.utility-pill.water{background-color:#00a8ff}.utility-pill.water .up-logo{background-image:url("+o+")}",""]),e.exports=t},495:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,a,i,l=e[1]||"",o=e[3];if(!o)return l;if(t&&"function"==typeof btoa){var r=(n=o,a=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(i," */")),c=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[l].concat(c).concat([r]).join("\n")}return[l].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,a){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(a)for(var l=0;l<this.length;l++){var o=this[l][0];null!=o&&(i[o]=!0)}for(var r=0;r<e.length;r++){var c=[].concat(e[r]);a&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},490:e=>{"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},264:(e,t,n)=>{"use strict";var a,i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),l=[];function o(e){for(var t=-1,n=0;n<l.length;n++)if(l[n].identifier===e){t=n;break}return t}function r(e,t){for(var n={},a=[],i=0;i<e.length;i++){var r=e[i],c=t.base?r[0]+t.base:r[0],u=n[c]||0,d="".concat(c," ").concat(u);n[c]=u+1;var s=o(d),f={css:r[1],media:r[2],sourceMap:r[3]};-1!==s?(l[s].references++,l[s].updater(f)):l.push({identifier:d,updater:p(f,t),references:1}),a.push(d)}return a}function c(e){var t=document.createElement("style"),a=e.attributes||{};if(void 0===a.nonce){var l=n.nc;l&&(a.nonce=l)}if(Object.keys(a).forEach((function(e){t.setAttribute(e,a[e])})),"function"==typeof e.insert)e.insert(t);else{var o=i(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var u,d=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function s(e,t,n,a){var i=n?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(e.styleSheet)e.styleSheet.cssText=d(t,i);else{var l=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(l,o[t]):e.appendChild(l)}}function f(e,t,n){var a=n.css,i=n.media,l=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),l&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(l))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var m=null,g=0;function p(e,t){var n,a,i;if(t.singleton){var l=g++;n=m||(m=c(t)),a=s.bind(null,n,l,!1),i=s.bind(null,n,l,!0)}else n=c(t),a=f.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a));var n=r(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var a=0;a<n.length;a++){var i=o(n[a]);l[i].references--}for(var c=r(e,t),u=0;u<n.length;u++){var d=o(n[u]);0===l[d].references&&(l[d].updater(),l.splice(d,1))}n=c}}}},485:(e,t,n)=>{var a=n(264),i=n(416);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},760:(e,t,n)=>{var a=n(264),i=n(133);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},273:(e,t,n)=>{var a=n(264),i=n(99);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},892:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20.718' height='22.426' viewBox='0 0 20.718 22.426'%3E%3Cdefs%3E%3Cstyle%3E.a%7Bfill:%23424242;%7D%3C/style%3E%3C/defs%3E%3Cpath class='a' d='M13.973,11.739c-.573,4.614-3.5,5.435-3.5,8.643a3.632,3.632,0,0,0,7.263,0c0-3.208-2.927-4.029-3.5-8.643a.136.136,0,0,0-.264,0ZM7.246,1.647c-.573,4.614-3.5,5.434-3.5,8.643a3.631,3.631,0,0,0,7.262,0c0-3.208-2.927-4.029-3.5-8.643a.135.135,0,0,0-.262,0Zm13.456,0c-.573,4.614-3.5,5.435-3.5,8.643a3.631,3.631,0,0,0,7.262,0c0-3.208-2.927-4.029-3.5-8.643a.135.135,0,0,0-.262,0Z' transform='translate(-3.746 -1.544)'/%3E%3C/svg%3E"},896:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,i)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(i,l){function o(e){try{c(a.next(e))}catch(e){l(e)}}function r(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PriceConfig=void 0;const r=l(n(363)),c=n(432);n(485);const u="TenantUMS";function d(e){return(Number(e)||0).toFixed(2)}t.PriceConfig=e=>{const[t,n]=r.default.useState(""),[a,i]=r.default.useState(""),[l,s]=r.default.useState(""),[f,m]=r.default.useState(!0),[g,p]=r.default.useState(""),v=(0,c.useToast)(),h=(0,r.useRef)();return r.default.useEffect((()=>{e.uxpContext.executeAction(u,"GetGlobalSettings",{},{json:!0}).then((e=>{let t=(null==e?void 0:e.settings)||{};n(d(t.energyRate)),i(d(t.waterRate)),s((100*(Number(t.taxRate)||0)).toFixed(3)),p(t.invoiceHtml||""),m(!1)})).catch((e=>{v.error(e||"An error occurred while loading settings")}))}),[]),r.default.createElement(c.WidgetWrapper,{className:"tu-price-config"},f&&r.default.createElement(c.DefaultLoader,null),!f&&r.default.createElement(r.default.Fragment,null,r.default.createElement(c.TitleBar,{title:"Global Tenant Utility Metering Configuration"}),r.default.createElement("div",{className:"tu-config-container"},r.default.createElement("div",{className:"tu-col"},r.default.createElement("div",{className:"tu-c"},r.default.createElement("h3",{className:"energy"},r.default.createElement("span",{className:"tu-icon energy"}),"Energy Rates"),r.default.createElement("div",{className:"tu-energy"},r.default.createElement("label",null,"Per-Unit Rate"),r.default.createElement("div",{className:"tu-unit"},"$"),r.default.createElement(c.Input,{value:t,onChange:n}),r.default.createElement("div",{className:"tu-unit"},"/kwh"))),r.default.createElement("div",{className:"tu-c"},r.default.createElement("h3",{className:"water"},r.default.createElement("span",{className:"tu-icon water"}),"Water Rates"),r.default.createElement("div",{className:"tu-water"},r.default.createElement("label",null,"Per-Unit Rate"),r.default.createElement("div",{className:"tu-unit"},"$"),r.default.createElement(c.Input,{value:a,onChange:i}),r.default.createElement("div",{className:"tu-unit"},"/ltr")))),r.default.createElement("div",{className:"tu-col"},r.default.createElement("div",{className:"tu-c"},r.default.createElement("h3",{className:"tax"},r.default.createElement("span",{className:"tu-icon tax"}),"Tax Rate"),r.default.createElement("div",{className:"tu-tax"},r.default.createElement("label",null,"Rate"),r.default.createElement("div",{className:"tu-unit"}),r.default.createElement(c.Input,{value:l,onChange:s}),r.default.createElement("div",{className:"tu-unit"},"%"))),r.default.createElement("div",{className:"tu-c"},r.default.createElement("h3",{className:"invoice"},r.default.createElement("span",{className:"tu-icon invoice"}),"Invoice Template"),r.default.createElement("div",{className:"tu-invoice"},r.default.createElement("input",{accept:"text/html",onChange:function(e){var t=e.target.files[0];if(console.log(t),t){var n=new FileReader;n.onload=function(e){p(e.target.result),console.log(e.target.result)},n.readAsText(t)}},style:{display:"none"},type:"file",ref:h}),r.default.createElement("a",{className:"tu-upload",onClick:function(){var e;let t=h.current;t&&(null===(e=null==t?void 0:t.click)||void 0===e||e.call(t))}},"Select a template"),r.default.createElement("div",{className:"tu-invoice-content"},g.length?r.default.createElement(r.default.Fragment,null,`${g.length} bytes`,r.default.createElement(c.IconButton,{type:"arrow-down",onClick:function(){if(g){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(g)),e.setAttribute("download","invoice-template.html"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}})):""))))),r.default.createElement("div",{className:"tu-action"},r.default.createElement("div",{className:"save"},r.default.createElement(c.AsyncButton,{title:"Save",onClick:()=>o(void 0,void 0,void 0,(function*(){try{yield e.uxpContext.executeAction(u,"SaveGlobalSettings",{settings:{energyRate:Number(t),waterRate:Number(a),taxRate:Number(l)/100,invoiceHtml:g}}),v.success("Configuration saved!")}catch(e){v.error(e||"An error ocurred while saving")}}))})))))}},405:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,i)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(i,l){function o(e){try{c(a.next(e))}catch(e){l(e)}}function r(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MyInvoices=t.TenantInvoices=void 0;const r=l(n(363)),c=n(432);n(760);const u=e=>{var t,n,a,i,l,u,d,s,f;let m=e.invoice,g=m.invoice.tags.find((e=>"energy"==e.type)),p=m.invoice.tags.find((e=>"water"==e.type)),v=m.invoice.total,h=m.invoice.onlyTotal,b=m.tenant,x=Number(null===(t=m.invoice)||void 0===t?void 0:t.discount)||0,y=Number(null===(a=null===(n=m.invoice)||void 0===n?void 0:n.metadata)||void 0===a?void 0:a.tax)||0,w=Number(null===(u=null===(l=null===(i=m.invoice)||void 0===i?void 0:i.metadata)||void 0===l?void 0:l.rates)||void 0===u?void 0:u.energy)||0,E=Number(null===(f=null===(s=null===(d=m.invoice)||void 0===d?void 0:d.metadata)||void 0===s?void 0:s.rates)||void 0===f?void 0:f.water)||0,N=Number(null==g?void 0:g.consumption)||0,M=N*w,C=Number(null==p?void 0:p.consumption)||0,T=C*E,[I,S]=(0,r.useState)((100*x).toFixed(2)),j=(Number(I)||0)/100,k=h*(1-j)*(1+y),O=(0,c.useAlert)(),D=(0,c.useToast)();return r.default.createElement(c.Modal,{autoSize:!0,className:"tu-invoice-details",title:`Invoice ${m.id}`,show:!!m,onClose:()=>{var t;return null===(t=null==e?void 0:e.onClose)||void 0===t?void 0:t.call(e)}},r.default.createElement("div",{className:"tu-header"},r.default.createElement("h1",{style:{textTransform:"uppercase"}},b),r.default.createElement("div",{className:"tu-dates"},r.default.createElement("div",{className:"tu-date"},r.default.createElement("span",null,"From"),r.default.createElement("div",null,new Date(m.start).toLocaleDateString())),r.default.createElement("div",{className:"tu-date"},r.default.createElement("span",null,"To"),r.default.createElement("div",null,new Date(m.start).toLocaleDateString())))),r.default.createElement("div",{className:"tu-id-items"},g&&r.default.createElement("div",{className:"tu-id-item"},r.default.createElement("div",{className:"desc energy"},r.default.createElement("div",{className:"utility-pill energy"},r.default.createElement("div",{className:"up-logo"}),r.default.createElement("div",{className:"up-txt"},"Energy"))),r.default.createElement("div",{className:"consumption"},N.toFixed(2)+"kwh"),r.default.createElement("div",{className:"cost"},"$"+M.toFixed(2))),p&&r.default.createElement("div",{className:"tu-id-item"},r.default.createElement("div",{className:"desc water"},r.default.createElement("div",{className:"utility-pill water"},r.default.createElement("div",{className:"up-logo"}),r.default.createElement("div",{className:"up-txt"},"Water"))),r.default.createElement("div",{className:"consumption"},C.toFixed(2)+"kwh"),r.default.createElement("div",{className:"cost"},"$"+T.toFixed(2))),(x||e.editable)&&r.default.createElement("div",{className:"tu-id-item"},r.default.createElement("div",{className:"desc discount"}),r.default.createElement("div",{className:"consumption"},"Discount"),!e.editable&&r.default.createElement("div",{className:"cost"},(100*x).toFixed(2)+"%"),e.editable&&r.default.createElement("div",{className:"cost editable"},r.default.createElement(c.Input,{className:"tu-edit-discount",value:I,onChange:S}),r.default.createElement("span",{className:"discout-unit"},"%"))),r.default.createElement("div",{className:"tu-id-item"},r.default.createElement("div",{className:"desc discount"}),r.default.createElement("div",{className:"consumption"},"Tax"),r.default.createElement("div",{className:"cost"},(100*y).toFixed(2)+"%")),r.default.createElement("div",{className:"tu-id-item total"},r.default.createElement("div",{className:"desc total"},"Total"),r.default.createElement("div",{className:"consumption"}),!e.editable&&r.default.createElement("div",{className:"cost"},"$"+v.toFixed(2)),e.editable&&r.default.createElement("div",{className:"cost"},"$"+k.toFixed(2)))),e.editable&&x!=j&&r.default.createElement("div",{className:"actions"},r.default.createElement(c.AsyncButton,{title:"Apply Discount",onClick:()=>o(void 0,void 0,void 0,(function*(){try{if(j>1)return void(yield O.show("Um, your discount shouldn't be more than 100%."));yield e.uxpContext.executeAction("TenantUMS","EditInvoice",{invoice:m.id,discount:j},{json:!0}),D.success("Discount applied"),null==e||e.onSave()}catch(e){O.show(e)}}))})))},d=e=>{let[t,n]=r.default.useState(null),a=(0,c.useToast)(),i=(0,c.useAlert)(),l=e.invoices.slice();return l.sort(((e,t)=>Number(new Date(e.start))-Number(new Date(t.start)))),r.default.createElement(r.default.Fragment,null,r.default.createElement(c.DataTable,{className:"tenants",data:l,pageSize:5,activeClass:"active",columns:[{title:"Tenant",width:"20%",renderColumn:e=>r.default.createElement("div",{className:"data-table-item"},null==e?void 0:e.tenant)},{title:"Start",width:"15%",renderColumn:e=>r.default.createElement("div",{className:"data-table-item"},new Date(e.start).toLocaleDateString())},{title:"End",width:"10%",renderColumn:e=>r.default.createElement("div",{className:"data-table-item"},new Date(e.end).toLocaleDateString())},{title:"Amount",width:"10%",renderColumn:e=>{var t;return r.default.createElement("div",{className:"data-table-item"},"$"+(Number(null===(t=null==e?void 0:e.invoice)||void 0===t?void 0:t.total)||0).toFixed(2))}},{title:"Status",width:"10%",renderColumn:e=>r.default.createElement("div",{className:"data-table-item invoice-status "+e.status},e.status)},{title:" ",width:"10%",renderColumn:e=>r.default.createElement("a",{href:"#",onClick:()=>n(e)},"View Invoice")},{title:" ",width:"20%",renderColumn:t=>r.default.createElement("div",{className:"invoice-actions"},"paid"!=t.status&&e.editable&&r.default.createElement(c.AsyncButton,{title:"Mark as Paid",onClick:()=>o(void 0,void 0,void 0,(function*(){try{yield e.uxpContext.executeAction("TenantUMS","UpdateInvoiceStatus",{invoice:null==t?void 0:t.id,status:"paid"},{json:!0}),a.success("Marked as paid!💪"),null==e||e.onUpdate()}catch(e){i.show(e)}}))}),r.default.createElement(c.AsyncButton,{title:"Download",className:"download-invoice",onClick:()=>o(void 0,void 0,void 0,(function*(){return function(t){return o(this,void 0,void 0,(function*(){try{let n=(yield e.uxpContext.executeAction("TenantUMS","GetInvoice",{id:t},{json:!0})).url||"";if(!n)throw"No url found";window.open(n)}catch(e){i.show("An error occurred while trying to download the invoice. Please try again later")}}))}(null==t?void 0:t.id)}))}))}]}),t&&r.default.createElement(u,{onSave:()=>null==e?void 0:e.onUpdate(),editable:e.editable&&!("paid"==t.status),invoice:t,uxpContext:e.uxpContext,onClose:()=>n(null)}))};t.TenantInvoices=e=>{const t=(0,c.useToast)(),[n,a]=(0,r.useState)([]),[i,l]=(0,r.useState)([]),[o,u]=(0,r.useState)(""),[s,f]=r.default.useState(1);return r.default.useEffect((()=>{e.uxpContext.executeAction("TenantUMS","GetInvoices",{tenant:o},{json:!0}).then((e=>{l((null==e?void 0:e.invoices)||[])})).catch((e=>{t.error(e||"An error occurred while loading invoices")}))}),[o,s]),(0,r.useEffect)((()=>{e.uxpContext.executeAction("TenantUMS","GetAllTenants",{},{json:!0}).then((e=>a((null==e?void 0:e.tenants)||[])))}),[]),r.default.createElement(c.WidgetWrapper,null,r.default.createElement(c.TitleBar,{title:"Invoices"},r.default.createElement(c.FilterPanel,null,r.default.createElement(c.Select,{options:n,labelField:"tenantName",valueField:"tenantID",selected:o,onChange:u}))),r.default.createElement(d,{uxpContext:e.uxpContext,editable:!0,invoices:i,onUpdate:()=>f((e=>e+1))}))},t.MyInvoices=e=>{const t=(0,c.useToast)(),[n,a]=(0,r.useState)([]),[i,l]=(0,r.useState)([]),[o,u]=(0,r.useState)("");return r.default.useEffect((()=>{e.uxpContext.executeAction("TenantUMS","GetMyInvoices",{},{json:!0}).then((e=>{l((null==e?void 0:e.invoices)||[])})).catch((e=>{t.error(e||"An error occurred while loading invoices")}))}),[o]),r.default.createElement(c.WidgetWrapper,null,r.default.createElement(c.TitleBar,{title:"My Invoices"}),r.default.createElement(d,{editable:!1,invoices:i}))}},632:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,i)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(i,l){function o(e){try{c(a.next(e))}catch(e){l(e)}}function r(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=l(n(363)),c=n(432);t.default=e=>{const t=(0,c.useToast)(),[n,a]=(0,r.useState)([]),[i,l]=(0,r.useState)([]),[u,d]=(0,r.useState)(""),[s,f]=(0,r.useState)([]),[m,g]=(0,r.useState)(null),[p,v]=(0,r.useState)(null),[h,b]=(0,r.useState)(!1),[x,y]=(0,r.useState)(null),[w,E]=(0,r.useState)([]),[N,M]=(0,r.useState)(null),[C,T]=r.default.useState("energy");function I(){return o(this,void 0,void 0,(function*(){const t=yield e.uxpContext.executeAction("TenantUMS","GetAllRegisteredMeters",{}),n=JSON.parse(t);f(n)}))}return(0,r.useEffect)((()=>{!function(){o(this,void 0,void 0,(function*(){const t=yield e.uxpContext.executeAction("TenantUMS","GetAllMeters",{type:C}),n=JSON.parse(t);l(n)}))}()}),[C]),(0,r.useEffect)((()=>{I(),function(){o(this,void 0,void 0,(function*(){const t=yield e.uxpContext.executeAction("TenantUMS","GetAllTenants",{}),n=JSON.parse(t);a(null==n?void 0:n.tenants)}))}()}),[]),r.default.createElement(c.WidgetWrapper,null,r.default.createElement(c.TitleBar,{title:"Tenant Meter Configuration"}),r.default.createElement(c.DataTable,{className:"tenants",data:n,pageSize:5,activeClass:"active",columns:[{title:"Name",width:"40%",renderColumn:e=>r.default.createElement("div",{className:"data-table-item"},null==e?void 0:e.tenantName)},{title:"Meters",width:"40%",renderColumn:e=>r.default.createElement("div",{className:"data-table-item"},function(e){const t=s.filter((t=>t.tenant===e));let n=t.filter((e=>"water"==e.type)),a=t.filter((e=>"energy"==e.type));return r.default.createElement(r.default.Fragment,null,r.default.createElement("div",{className:"tu-meters water"},n.map((e=>r.default.createElement("div",{className:"tu-meter-id"},r.default.createElement("div",{className:"tu-logo"}),r.default.createElement("div",{className:"tu-txt"},e.meter))))),r.default.createElement("div",{className:"tu-meters energy"},a.map((e=>r.default.createElement("div",{className:"tu-meter-id"},r.default.createElement("div",{className:"tu-logo"}),r.default.createElement("div",{className:"tu-txt"},e.meter))))))}(null==e?void 0:e.tenantID))},{title:"",width:"20%",renderColumn:e=>r.default.createElement(c.Button,{title:"Edit",onClick:()=>function(e){b(!0),g(e);const t=s.filter((t=>t.tenant===e.tenantID));E(t)}(e)})}]}),r.default.createElement(c.Modal,{className:"add-meter",title:"Register Meter",show:h,onClose:()=>b(!1),headerContent:r.default.createElement(r.default.Fragment,null,r.default.createElement(c.ToggleFilter,{options:[{value:"energy",label:"Energy"},{value:"water",label:"Water"}],value:C,onChange:T}))},r.default.createElement("div",{className:"register-meter"},r.default.createElement("div",{className:"row"},r.default.createElement("div",{className:"col"},r.default.createElement(c.Label,null,"Select Meter"),r.default.createElement(c.Select,{options:i,selected:p,valueField:"id",labelField:"name",onChange:e=>{y(null),v(e)}})),r.default.createElement("div",{className:"col"},r.default.createElement(c.Label,null,"Budget"),r.default.createElement(c.Input,{type:"number",value:u,onChange:e=>{y(null),d(e)}}))),x&&r.default.createElement("div",{className:"error"},x),r.default.createElement("div",{className:"actions"},r.default.createElement(c.AsyncButton,{title:"Add Meter",onClick:()=>function(){return o(this,void 0,void 0,(function*(){if(!p)return void y("Please select a meter from the list");const n={budget:u,meterId:p,tenantId:null==m?void 0:m.tenantID,type:C};"{}"===(yield e.uxpContext.executeAction("TenantUMS","AddMeter",n))?t.error("This meter is already in use, please check for another meter"):t.info("Meter added successfully!!!"),d(""),b(!1),v(null),I()}))}()}))),r.default.createElement("div",{className:"delete-meter"},r.default.createElement("div",{className:"col"},r.default.createElement(c.Label,null,"Select Meter"),r.default.createElement(c.Select,{options:w,selected:N,valueField:"meter",labelField:"meter",onChange:e=>{y(null),M(e)}})),r.default.createElement("div",{className:"actions"},r.default.createElement(c.AsyncButton,{title:"Delete Meter",onClick:()=>function(){return o(this,void 0,void 0,(function*(){const t={meterId:N,tenantId:null==m?void 0:m.tenantID,type:C};yield e.uxpContext.executeAction("TenantUMS","DeleteMeterForTenant",t),b(!1),I()}))}()})))))}},629:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(484);n(273);const l=a(n(632)),o=n(896),r=n(405);(0,i.registerWidget)({id:"ums_tenant",widget:l.default,configs:{layout:{}}}),(0,i.registerWidget)({id:"price-config",widget:o.PriceConfig,configs:{layout:{}}}),(0,i.registerWidget)({id:"invoices",widget:r.TenantInvoices,configs:{layout:{}}}),(0,i.registerWidget)({id:"my-invoices",widget:r.MyInvoices,configs:{layout:{}}})},484:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.registerCustomWidgetTemplate=t.getUrlFriendlyString=t.enableLocalization=t.registerUI=t.registerMenuItem=t.registerLink=t.registerWidget=void 0;const i=a(n(354)),l=a(n(316));function o(e){var t;let n=(i.default.id+"/widget/"+e.id).toLowerCase();if(!window.registerWidget)return void console.error("This code is not being run within the context of UXP");let a=null===(t=i.default.widgets)||void 0===t?void 0:t.find((t=>t.id==e.id));if(!a)throw console.log("Please update the bundle.json"),"Error: The widget you are trying to register is not in the bundle.json. Please update the bundle.json before continue";let l=Object.assign(Object.assign(Object.assign({},e),a),{id:n});window.registerWidget(l)}t.registerWidget=o,t.registerLink=function(e){var t;let n=(i.default.id+"/sidebarlink/"+e.id).toLowerCase();if(!window.registerLink)return void console.error("This is not is not being run within the UXP context");console.log("registering link....",n);let a=null===(t=i.default.sidebarLinks)||void 0===t?void 0:t.find((t=>t.id==e.id));if(!a)throw console.log("Please update the bundle.json"),"Error: The sidebar link you are trying to register is not in the bundle.json. Please update the bundle.json before continue";let l=Object.assign(Object.assign(Object.assign({},e),a),{id:n});window.registerLink(l)},t.registerMenuItem=function(e){let t=(i.default.id+"/menuitem/"+e.id).toLowerCase();if(!window.registerMenuItem)return void console.error("This is not is not being run within the UXP context");console.log("registering menu item....",t);let n=i.default.menuItems.find((t=>t.id==e.id));if(!n)throw console.log("Please update the bundle.json"),"Error: The menu item you are trying to register is not in the bundle.json. Please update the bundle.json before continue";let a=Object.assign(Object.assign(Object.assign({},e),n),{id:t});window.registerMenuItem(a)},t.registerUI=function(e){let t=(i.default.id+"/ui/"+e.id).toLowerCase();if(!window.registerUI)return void console.error("This is not is not being run within the UXP context");console.log("registering link....",t);let n=i.default.uis.find((t=>t.id==e.id));if(!n)throw console.log("Please update the bundle.json"),"Error: The ui you are trying to register is not in the bundle.json. Please update the bundle.json before continue";let a=Object.assign(Object.assign(Object.assign({},e),n),{id:t});window.registerUI(a)},t.enableLocalization=function(){window.registerLocalization(l.default)},t.getUrlFriendlyString=(e,t)=>e.split("").map(((e,t)=>e.replace(new RegExp("ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;".charAt(t),"g"),"aaaaaeeeeeiiiiooooouuuunc------".charAt(t)))).toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/'/g,"-e").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-"),t.registerCustomWidgetTemplate=function(e){let n=(0,t.getUrlFriendlyString)(e.id);e.icon||(e.icon=["fad","align-justify"]),window.registerCustomWidgetTemplate(e),o({id:n,widget:e.template,isTemplate:!0,isDefaultTemplate:!1,configs:{layout:e.layout||{w:10,h:10},props:[{name:"uiProps",label:"UI",type:"json"}],preLoader:(null==e?void 0:e.preLoader)||"default"},defaultProps:{uiProps:{}}})}},363:e=>{"use strict";e.exports=React},432:e=>{"use strict";e.exports=UXPComponents},354:e=>{"use strict";e.exports=JSON.parse('{"id":"dece8055-b3de-42ec-b596-8ffa8fd0a794","author":"eutech","widgets":[{"id":"ums_tenant","name":"Tenant Meter Configuration","description":"Assign meters to tenants","icon":"","tags":[]},{"id":"price-config","name":"Tenant Utility Metering Configuration","description":"This widget is for configuring various rates and parameters for tenant utility metering and billing","icon":"","tags":[]},{"id":"invoices","name":"Tenant Utility  Invoices","description":"A list of invoices that have been generated","icon":"","tags":[]},{"id":"my-invoices","name":"My Utility  Invoices","description":"A list of invoices for the tenant that I am a part of","icon":"","tags":[]}],"sidebarLinks":[],"uis":[],"menuItems":[]}')},316:e=>{"use strict";e.exports={}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var l=t[a]={id:a,exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.nc=void 0,n(629)})();
//# sourceMappingURL=main.js.map